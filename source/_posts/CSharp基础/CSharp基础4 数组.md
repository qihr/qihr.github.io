---
title: CSharp基础4 数组
tags: [CSharp]
categories: Program
date: 2020-02-19 23:51:13 
---

枚举相关内容

Array

<!-- more -->

# 1.1 概述

- 数组一旦创建大小就会固定。c#不支持动态数组。
- 数组是对象，引用类型，继承自System.Array，继承BCL基类。
- 数组被创建后元素会被自动初始化为类型默认值。

数组的几个重要定义：

1. 元素
2. 秩/维度：是几维的数组。
3. 维度长度：每一个维度的长度。
4. 数组长度：数组的所有维度的元素总和。

两种类型的数组：

1. 一维数组：单行元素或元素向量。
2. 多维数组：由主向量中的位置组成的，每个位置本身就是个数组，成为子数组。多维数组有两种，矩形数组和交错数组。

数组的存储：

- System.Array继承的方法和数组的元素在堆上，数组本身对象的引用在栈或者堆上。
- 如果存储的元素都是值类型，则称数组为值类型数组。
- 如果元素都是引用类型对象，则称数组为引用类型数组。

# 1.2 一维数组和矩形数组

声明时的逗号是秩说明符，指定了数组的维度。

```csharp
//声明方式,几个逗号就是数量+1维度的数组。
int[] arrty11;
int[，，] arrty11;
```

不能在数组类型区域中设置数组的维度长度。秩是数组类型的一部分，但长度不是。

```csharp
int[2,3,3] arrty11；//不可以。
```

*注：c/c++方括号是放在基类型的后面，不是在变量名称后面。

实例化数组：

```csharp
int[] arr2 = new int[4]; //4个元素
MyClass[] mcArr = new MyClass[4]; //数组创建表达式
int[,,,] arr3 = new int[3,6,2];
```

矩形数组的元素获取方式：

```csharp
int[] arr2 = new int[4,10];
arr2[2,3] = 7;
int a = arr2[2,3];
```

初始化列表用于显示的初始化数组。不用输入长度，会自动判断:

```csharp
int[] arr = new int[]{10,20,30,40};
int[,,] arr = new int[,]{{10,20,30,40},{2,3}};

//这样初始化矩形数组是一个技巧，逗号不在大括号的内部使用，同时使用缩进和回车。
//可以读成：4组两个元素一组的三组分组。
int[,,] arr = new int[4,3,2]{
    {{10,20},{2,3},{2,3}}
    {{10,20},{2,3},{2,3}}
    {{10,20},{2,3},{2,3}}
	};

//也可以省略new的部分：
int[] arr = {10,20,30,40};

//数组也可以是隐式类型的
var arr = {10,20,30,40};
//但是秩说明符还是要有的。
var arr =  new [,]{{10,20,30,40},{2,3}};

```

# 1.3 交错数组

交错数组是数组的数组。交错数组的结构是，堆中存在着顶层数组，顶层数组的每一个元素保存着每一个子数组在堆上的位置。

```csharp
//注意声明方式和一维数组，矩形数组的不同。
//
int[][] jagArr = new int[3][] //声明并创建顶层数组
jagArr[0] = new int[]{10,20,30,40}; //声明并创建子数组
....
```

注意：

- 声明语句中不能初始化顶层数组之外的数组。
- 交错数组的实例化无法在一个步骤中完成，因为每个子数组都是独立的。
- 交错数组中也可以有矩形数组。

其实交错数组就相当于保存了各个子数组的引用。

# 1.4 交错数组和矩形数组的差别

两者的结构区别很大：

```csharp
//堆上矩形数组的结构 Attr[3,3]
56|23|32
45|43|21
12|21|32
```

```csharp
//堆上交错数组的结构 Attr[3][3]
Attr[0] ---> 56|23|32   
Attr[1] --> 45|43|21
Attr[2] -> 12|21|32
```

BCL中，一维数组有特定的指令用于性能优化，矩形数组没有。并且不能在相同级别进行优化，所以有时使用一维数组（可以被优化）的交错数组比矩形数组（不能被优化）更有效率。但矩形数组的编程复杂程度很小。

# 1.5 数组协变

某个对象不是数组的基类型，也可以把它赋值给数组元素。这种属性叫数组协变。值类型数组没有协变。

以下情况可以使用数组协变：

1. 数组是引用类型数组。
2. 在赋值的对象类型和数组基类型之间有隐式或者显示转换。（一般是存在继承关系）

例子：

```csharp
class A{...}
class B:A{...}
class Program{
    static void Mian()
    {
        //两个A类型的数组
        A[] array1 = new A[3];
        A[] array2 = new A[3];
        
        //普通：
        array1[0] = new A();   array1[1] = new A();
        //协变：将b类型的对象赋值给A类型的数组
        array2[0] = new B();   array2[1] = new B();
    }
}
```

个人理解：规则是赋值对象和数组基类型有显示或隐式转换，而没有强调存在继承关系，就说明协变和父子类之间的关系是没有必要的联系的。重要的是数组协变提供了将兼容不同类型元素的办法。

# 1.6 数组继承的一些成员

**clone方法：**

为数组进行浅复制，只创建了数组本身的克隆。如果是引用类型数组，他不会复制元素引用的对象。但clone值类型数组会产生两个独立数组。







